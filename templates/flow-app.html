<html>
<head>
	<link rel="stylesheet" type="text/css" href="/static/bootstrap/css/bootstrap.min.css">
	<script src="/static/js/jquery-1.11.3.min.js"></script>
	<script src="/static/bootstrap/js/bootstrap.min.js"></script>
	<script src="/ext/flow-server/static/external/svg.min.js"></script>
	<script src="/static/js/moment.min.js"></script>
	<script src="/ext/flow-server/static/common/core.js"></script>
	<script src="/ext/flow-server/static/common/messages.js"></script>
	<script src="/ext/flow-server/static/common/ble-messages.js"></script>
	<script src="/ext/flow-server/static/common/manylabs-ble.js"></script>
	<script src="/ext/flow-server/static/common/pako.js"></script>
	<script src="/ext/flow-server/static/external/manyplot.js"></script>
	<script src="/ext/flow-server/static/flow/flow-util.js"></script>
	<script src="/ext/flow-server/static/flow/flow-app.js"></script>

    <script src="/ext/flow-server/static/flow/util/message-executor.js">
    </script>
    <script src="/ext/flow-server/static/flow/views/base-view.js">
    </script>

    <!--
      -
      - Login page components.
      -
      -->
    <script 
      src="/ext/flow-server/static/flow/views/login-page-view.js">
    </script>
 
    <!--
      -
      - Landing page components.
      -
      -->
    <script 
      src="/ext/flow-server/static/flow/views/landing-page-view.js">
    </script>
    <script 
      src="/ext/flow-server/static/flow/views/landing-page-my-programs-view.js">
    </script>
    <script 
      src="/ext/flow-server/static/flow/views/landing-page-data-set-view.js">
    </script>
    <script 
      src="/ext/flow-server/static/flow/views/program-icon.js">
    </script>
    <script 
      src="/ext/flow-server/static/flow/views/data-set-icon.js">
    </script>

    <!--
      -
      - Program Editor UI components.
      -
      -->
    <script 
      src="/ext/flow-server/static/flow/views/program-editor-view.js">
    </script>
    <script 
      src="/ext/flow-server/static/flow/views/program-editor-file-manager.js">
    </script>
    <script 
      src="/ext/flow-server/static/flow/views/my-data-panel.js">
    </script>
    <script 
      src="/ext/flow-server/static/flow/views/pi-selector-panel.js">
    </script>
    <script 
      src="/ext/flow-server/static/flow/views/program-editor-panel.js">
    </script>
    <script 
      src="/ext/flow-server/static/flow/views/program-editor-block-palette.js">
    </script>

    <!--
      -
      - DataSet view components
      -
      -->
    <script 
      src="/ext/flow-server/static/flow/views/data-set-view.js">
    </script>
    <script 
      src="/ext/flow-server/static/flow/views/recording-status-panel.js">
    </script>

    <!--
      -
      - Admin view component
      -
      -->
    <script 
      src="/ext/flow-server/static/flow/views/admin-view.js">
    </script>


	<script src="/ext/flow-server/static/flow/ble-app.js"></script>
	<script src="/ext/flow-server/static/flow/diagram.js"></script>
	<script src="/ext/flow-server/static/flow/filters.js"></script>
	<script src="/ext/flow-server/static/flow/controller-selector.js"></script>
	<script src="/ext/flow-server/static/flow/controller-viewer.js"></script>

	<script src="/ext/flow-server/static/flow/admin-view.js"></script>

	<script src="/ext/flow-server/static/flow/diagram-editor.js"></script>
	<script src="/ext/flow-server/static/flow/plotter.js"></script>
    <script src="/ext/flow-server/static/external/jquery.hotkeys.js"></script>

{% if use_codap %}
	<script src="/ext/flow-server/static/external/iframe-phone.js"></script>
	<script src="/ext/flow-server/static/external/CodapInterface.js"></script>
	<script src="/ext/flow-server/static/flow/codap-bridge.js"></script>
{% else %}
	<script type="text/javascript" src="/static/js/download.js"></script>
    <script>
        window.CodapTest = {
            logTopic: function () {}
        };
    </script>
{% endif %}

	<link rel="stylesheet" href="/ext/flow-server/static/flow/style.css">
<title>Data Flow</title>
</head>
<body>

<div id="controllerSelectorPanel" class="flowPanel">
	<div class="row">
		<div class="col-md-3"></div>
		<div class="col-md-6">
             

			<h2 id="controllerSelectorLabel"></h2>

			<div id="controllerList"></div>

{% if dev_enabled %}
			<button id="bleButton" class="btn btn-primary" onclick="bleStartConnect()">Select Bluetooth Device</button>
{% endif %}

		</div>
		<div class="col-md-3"></div>
	</div>
</div>

<!--
   -
   - Controller admin panel
   -
   -->
<div id="controllerAdminPanel" class="flowPanel">

    <div class="col-md-3"></div>

    <h2 id="controllerAdminLabel">Controller Administration</h2>

    <div id="controllerAdminContent">
    </div>
</div>

<!--
   -
   - This panel displays the status for a single controller
   - and lists diagrams belonging to that controller.
   -
   -->
<div id="controllerViewerPanel" class="flowPanel center-block">
    <div class="row">
        <div class="col-md-3"></div>
        <div class="col-md-6">
            <h2>Flow Diagrams</h2> (<span id="controllerName"></span>) 
            
            <span class="controllerStatus">
                <a  data-toggle="collapse"
                    href="#controllerStatus"
                    aria-expanded="false"
                    aria-controls="controllerStatus">Status</a>
            </span>

{% if admin_enabled %}
            <span class="controllerStatus">
                <a  data-toggle="collapse"
                    href="#controllerAdminStatus"
                    aria-expanded="false"
                    aria-controls="controllerAdminStatus">Admin</a>
            </span>
{% endif %}

            <div class="collapse" id="controllerStatus">
              <div class="well">
                ...
              </div>
            </div>

            <div class="collapse" id="controllerAdminStatus">
            </div>

            <div id="diagramList">Connecting to controller...</div>
            <button class="btn btn-primary" onclick="newDiagram()">New Diagram</button>
            <button class="btn btn-primary" onclick="closeControllerViewer()">Close Controller</button>
{% if dev_enabled %}
            <button id="bleButton" class="btn btn-primary" onclick="bleStartConnect()">Select Bluetooth Device</button>
{% endif %}
            <!--button class="btn" onclick="CodapTest.sendSequence([3,1,4,1,5,9,2,6,5]);">Test CODAP</button-->
            <!-- <button class="btn" onclick="sendMessage('request_status');">Check Status</button> -->
        </div>
        <div class="col-md-3"></div>
    </div>
</div>

<div id="diagramEditorPanel" class="flowPanel">

    <div id="diagramInfo">
        <b><span id="diagramControllerName"></span></b>
        <span id="diagramName"></span> <br />
        <span id="diagramInterval"></span>
    </div>
	<div id="diagramHolder">
	</div>

	<div class="menuBar">
		<button id="startRecording" class="btn btn-success" onclick="saveDiagram(false, false, startRecordingData);">Start Recording Data</button>
		<button id="stopRecording" class="btn btn-warning" onclick="stopRecordingData()">Stop Recording Data</button>

        <button id="addNumericBlockButton" 
                class="btn btn-primary" 
                onclick="addNumericBlock()">Add Numeric Entry</button>

		<button class="btn btn-primary" onclick="viewRecordedData()">View Recorded Data</button>
		<!--button class="btn btn-primary" onclick="zoominBlock()">Zoom In</button-->
		<!--button class="btn btn-primary" onclick="zoomoutBlock()">Zoom Out</button-->

        <button id="addFilterButton" 
                class="btn btn-primary" 
                onclick="showFilterBlockSelector()">Add Filter</button>

        <button id="addPlotButton"  
                class="btn btn-primary" 
                onclick="addPlotBlock()">Add Plot</button>

        <button id="saveDiagramButton"
                class="btn btn-primary"
                onclick="saveDiagramAndStart(false, false)">Save</button>

        <button class="btn btn-primary"
                onclick="closeDiagramEditor()">Close Diagram</button>

{% if dev_enabled %}
		<button id="bleButton" class="btn btn-primary" onclick="bleStartConnect()">Select Bluetooth Device</button>
		<button class="btn" onclick="sendMessage('add_camera')">Add Camera</button>
		<button class="btn" onclick="sendMessage('add_sim_sensor')">Add Sim Sensor</button>
		<button class="btn" onclick="sendMessage('add_sim_actuator')">Add Sim Actuator</button>
		<button class="btn" onclick="sendMessage('remove_sim_device')">Remove Sim Device</button>
{% endif %}
	</div>
    <div id="bleResponseText" >
    </div>

</div>

<div id="plotterPanel" class="flowPanel">
	<div>
		<canvas id="canvas"></canvas>
		<div class="timeframe-label">Select timeframe:</div>
		<div class="btn-group timeframe" role="group" aria-label="timeframe">
		  <button type="button" class="btn btn-default" onclick="setTimeFrame('1m')">1 min</button>
			<button type="button" class="btn btn-default" onclick="setTimeFrame('10m')">10 mins</button>
			<button type="button" class="btn btn-default" onclick="setTimeFrame('1h')">1 hr</button>
			<button type="button" class="btn btn-default" onclick="setTimeFrame('24h')">24 hrs</button>
			<button type="button" class="btn btn-default" onclick="setTimeFrame('7d')">7 days</button>
			<button type="button" class="btn btn-default" onclick="setTimeFrame('30d')">30 days</button>
		</div>
	</div>
	<div class="menuBar">
		<button class="btn" id="selectInterval" onclick="selectInterval()">Select Interval</button>
		{% if use_codap %}
		<button class="btn" onclick="exploreRecordedDataInCODAP()">Explore Data in CODAP</button>
		{% else %}
		<button class="btn" onclick="downloadRecordedData()">Download Data</button>
		{% endif %}
		<button class="btn" onclick="g_plotHandler.zoomIn()">Zoom In</button>
		<button class="btn" onclick="g_plotHandler.zoomOut()">Zoom Out</button>
		<button class="btn btn-danger" onclick="deleteSequenceData()">Delete Data</button>
		<button class="btn btn-primary" onclick="closePlotter()">Close History Viewer</button>
	</div>
</div>

<!--
  -
  - New DF2.0 views. 
  -
  -->
<div    id="login-page-view" ></div>
<div    id="landing-page-view"
        class="landing-page-padding" ></div>

<div    id="admin-view" ></div>
<div    id="program-editor-view" ></div>
<div    id="data-set-view" ></div>



<script>

var g_controllers = {{ controllers_json|safe }};  // list of available controllers
var g_controller = null;  // the currently selected controller
var g_csrfToken = '{{ csrf_token() }}';
var g_jsSim = false;
var g_useCodap = {{ use_codap }};
var g_devEnabled = {{ dev_enabled }};
var g_adminEnabled = {{ admin_enabled }};
var g_featuresEnabled = {{ features_enabled }};
var g_testblocksEnabled = {{ testblocks_enabled }};
var g_user                  = {{ flow_user|safe }};
var g_rhizo_server_version  = '{{ rhizo_server_version }}';
var g_flow_server_version   = '{{ flow_server_version }}';

$(function() {
	initFlowApp();
{% if use_codap %}
	initCodapBridge();
{% endif %}
});

</script>
</body>
</html>
